(()=>{const d=document,w=window,reduce=w.matchMedia('(prefers-reduced-motion: reduce)').matches;d.body.classList.remove('no-js');const navBtn=d.querySelector('.nav-toggle'),nav=d.querySelector('.site-nav');if(navBtn&&nav){const closeNav=()=>{nav.classList.remove('open');navBtn.setAttribute('aria-expanded','false')};navBtn.addEventListener('click',()=>{const open=nav.classList.toggle('open');navBtn.setAttribute('aria-expanded',String(open))});nav.querySelectorAll('a').forEach(a=>a.addEventListener('click',closeNav));d.addEventListener('click',e=>{if(nav.classList.contains('open')&&!nav.contains(e.target)&&!navBtn.contains(e.target))closeNav()});d.addEventListener('keydown',e=>{if(e.key==='Escape')closeNav()})}if(!reduce&&'IntersectionObserver'in w){const io=new IntersectionObserver(entries=>{entries.forEach(entry=>{if(entry.isIntersecting){entry.target.classList.add('in');io.unobserve(entry.target)}})},{threshold:.14});d.querySelectorAll('.reveal').forEach(el=>io.observe(el))}else d.querySelectorAll('.reveal').forEach(el=>el.classList.add('in'));const initHeroVideo=()=>{const section=d.querySelector('.hero-video-section'),pin=d.querySelector('.hero-pin'),video=d.querySelector('.hero-video');if(!section||!pin||!video||reduce)return;const gsap=w.gsap,ScrollTrigger=w.ScrollTrigger;if(!gsap||!ScrollTrigger)return;gsap.registerPlugin(ScrollTrigger);let targetTime=0,currentTime=0,rafId=0,duration=0;const clamp=(v,min,max)=>Math.min(max,Math.max(min,v));const tick=()=>{currentTime+=(targetTime-currentTime)*0.2;if(Math.abs(targetTime-currentTime)<.001)currentTime=targetTime;const safe=clamp(currentTime,0,Math.max(duration-.016,0));if(Math.abs(video.currentTime-safe)>.001)video.currentTime=safe;rafId=w.requestAnimationFrame(tick)};const start=()=>{duration=video.duration||0;if(!duration)return;video.pause();video.currentTime=0;targetTime=0;currentTime=0;if(rafId)w.cancelAnimationFrame(rafId);rafId=w.requestAnimationFrame(tick);ScrollTrigger.create({trigger:section,start:'top top',end:()=>`+=${Math.round(w.innerHeight*3)}`,pin:pin,scrub:1,invalidateOnRefresh:true,onUpdate:self=>{targetTime=self.progress*duration}})};if(video.readyState>=1)start();else video.addEventListener('loadedmetadata',start,{once:true})};const initReviewsSlider=()=>{const root=d.querySelector('.reviews-swiper'),Swiper=w.Swiper;if(!root||!Swiper)return;const wrap=root.querySelector('.swiper-wrapper');if(!wrap)return;let slides=[...wrap.children];if(!slides.length)return;for(let i=slides.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[slides[i],slides[j]]=[slides[j],slides[i]]}const target=Math.min(9,Math.max(6,slides.length));const base=[...slides];let idx=0;while(slides.length<target){slides.push(base[idx%base.length].cloneNode(true));idx++}slides=slides.slice(0,target);wrap.innerHTML='';slides.forEach(s=>{const rating=Math.random()<.45?'4.5/5':'5.0/5';const stars=s.querySelector('[data-stars]');const txt=s.querySelector('[data-rating-text]');if(stars)stars.textContent=rating==='4.5/5'?'★★★★☆':'★★★★★';if(txt)txt.textContent=rating;wrap.appendChild(s)});new Swiper('.reviews-swiper',{loop:true,speed:900,spaceBetween:16,slidesPerView:1,autoplay:{delay:2600,disableOnInteraction:false,pauseOnMouseEnter:true},pagination:{el:'.swiper-pagination',clickable:true},breakpoints:{768:{slidesPerView:2},1100:{slidesPerView:3}}})};w.addEventListener('load',()=>{initHeroVideo();initReviewsSlider()})})();