(()=>{const d=document,w=window,reduce=w.matchMedia('(prefers-reduced-motion: reduce)').matches;const isLowMemory=()=>((typeof navigator.deviceMemory==='number'&&navigator.deviceMemory<=2)||(navigator.connection&&navigator.connection.saveData===true));d.body.classList.remove('no-js');const navBtn=d.querySelector('.nav-toggle'),nav=d.querySelector('.site-nav');if(navBtn&&nav){const closeNav=()=>{nav.classList.remove('open');navBtn.setAttribute('aria-expanded','false')};navBtn.addEventListener('click',()=>{const open=nav.classList.toggle('open');navBtn.setAttribute('aria-expanded',String(open))});nav.querySelectorAll('a').forEach(a=>a.addEventListener('click',closeNav));d.addEventListener('click',e=>{if(nav.classList.contains('open')&&!nav.contains(e.target)&&!navBtn.contains(e.target))closeNav()});d.addEventListener('keydown',e=>{if(e.key==='Escape')closeNav()})}if(!reduce&&'IntersectionObserver'in w){const io=new IntersectionObserver(entries=>{entries.forEach(entry=>{if(entry.isIntersecting){entry.target.classList.add('in');io.unobserve(entry.target)}})},{threshold:.14});d.querySelectorAll('.reveal').forEach(el=>io.observe(el))}else d.querySelectorAll('.reveal').forEach(el=>el.classList.add('in'));const initHeroFrames=()=>{const section=d.querySelector('.hero-video-section'),pin=d.querySelector('.hero-pin'),canvas=d.querySelector('.hero-canvas'),poster=d.querySelector('.hero-poster');if(!section||!pin||!canvas)return;if(reduce||isLowMemory()){section.classList.add('reduced-motion');return}const gsap=w.gsap,ScrollTrigger=w.ScrollTrigger;if(!gsap||!ScrollTrigger)return;gsap.registerPlugin(ScrollTrigger);const ctx=canvas.getContext('2d',{alpha:false,desynchronized:true});if(!ctx)return;const framePath=section.dataset.framePath||'/assets/frames/biryani_',frameExt=(section.dataset.frameExt||'.webp').trim();const total=Math.max(1,parseInt(section.dataset.frameCount||'60',10));const sourceW=Math.max(1,parseInt(section.dataset.frameW||'1920',10));const sourceH=Math.max(1,parseInt(section.dataset.frameH||'1080',10));const pad=n=>String(n).padStart(4,'0');const clamp=(v,min,max)=>Math.min(max,Math.max(min,v));let heroTrigger=null,tickerFn=null,targetFrame=0,currentFrame=0,readyCount=0,started=false,rendered=false,activeExt=frameExt;const frames=new Array(total);const dpr=Math.min(2,w.devicePixelRatio||1);const drawFrame=i=>{const img=frames[i];if(!img||!img.complete)return;const rect=pin.getBoundingClientRect();const viewW=Math.max(1,Math.round(rect.width));const viewH=Math.max(1,Math.round(rect.height));const pixelW=Math.max(1,Math.round(viewW*dpr));const pixelH=Math.max(1,Math.round(viewH*dpr));if(canvas.width!==pixelW||canvas.height!==pixelH){canvas.width=pixelW;canvas.height=pixelH;canvas.style.width=`${viewW}px`;canvas.style.height=`${viewH}px`}ctx.setTransform(dpr,0,0,dpr,0,0);ctx.clearRect(0,0,viewW,viewH);const scale=Math.max(viewW/sourceW,viewH/sourceH);const drawW=sourceW*scale,drawH=sourceH*scale;const alignX=w.matchMedia('(max-width:760px)').matches ? .5 : .36;const dx=(viewW-drawW)*alignX,dy=(viewH-drawH)*.5;ctx.drawImage(img,dx,dy,drawW,drawH);if(!rendered&&poster){poster.classList.add('hidden');rendered=true}};const kill=()=>{if(heroTrigger){heroTrigger.kill();heroTrigger=null}if(tickerFn){gsap.ticker.remove(tickerFn);tickerFn=null}};const startTrigger=()=>{if(started)return;started=true;kill();targetFrame=0;currentFrame=0;drawFrame(0);tickerFn=()=>{const diff=targetFrame-currentFrame;if(Math.abs(diff)<.01)return;currentFrame+=diff*.18;drawFrame(clamp(Math.round(currentFrame),0,total-1))};gsap.ticker.add(tickerFn);heroTrigger=ScrollTrigger.create({id:'heroFramePin',trigger:section,start:'top top',end:'+=420%',pin:pin,pinSpacing:true,scrub:1.2,anticipatePin:1,invalidateOnRefresh:true,onUpdate:self=>{targetFrame=clamp(self.progress*(total-1),0,total-1)}});ScrollTrigger.refresh()};const warmThreshold=Math.min(total,12);const maybeStart=()=>{if(frames[0]&&readyCount>=warmThreshold)startTrigger()};const loadFrame=(index,ext)=>new Promise((resolve,reject)=>{const img=new Image();img.decoding='async';if(index<=2)img.fetchPriority='high';img.onload=()=>{if(!frames[index-1]){frames[index-1]=img;readyCount+=1;if(index===1)drawFrame(0)}resolve()};img.onerror=reject;img.src=`${framePath}${pad(index)}${ext}`});const loadAll=async ext=>{for(let i=1;i<=total;i+=1){loadFrame(i,ext).then(maybeStart).catch(()=>{})}};loadFrame(1,activeExt).then(()=>{maybeStart();loadAll(activeExt)}).catch(()=>{if(activeExt!=='.jpg'){activeExt='.jpg';if(poster){poster.src=`${framePath}${pad(1)}.jpg`}loadFrame(1,activeExt).then(()=>{maybeStart();loadAll(activeExt)}).catch(()=>{})}});w.addEventListener('resize',()=>{drawFrame(clamp(Math.round(currentFrame),0,total-1));if(heroTrigger)ScrollTrigger.refresh()},{passive:true});w.addEventListener('orientationchange',()=>{drawFrame(clamp(Math.round(currentFrame),0,total-1));if(heroTrigger)ScrollTrigger.refresh()},{passive:true});d.addEventListener('visibilitychange',()=>{if(!d.hidden)drawFrame(clamp(Math.round(currentFrame),0,total-1))})};const initReviewsSlider=()=>{const root=d.querySelector('.reviews-swiper'),Swiper=w.Swiper;if(!root||!Swiper)return;const wrap=root.querySelector('.swiper-wrapper');if(!wrap)return;let slides=[...wrap.children];if(!slides.length)return;for(let i=slides.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[slides[i],slides[j]]=[slides[j],slides[i]]}const target=Math.min(9,Math.max(6,slides.length));const base=[...slides];let idx=0;while(slides.length<target){slides.push(base[idx%base.length].cloneNode(true));idx++}slides=slides.slice(0,target);wrap.innerHTML='';slides.forEach(s=>{const rating=Math.random()<.45?'4.5/5':'5.0/5';const stars=s.querySelector('[data-stars]');const txt=s.querySelector('[data-rating-text]');if(stars)stars.textContent=rating==='4.5/5'?'★★★★☆':'★★★★★';if(txt)txt.textContent=rating;wrap.appendChild(s)});new Swiper('.reviews-swiper',{loop:true,speed:900,spaceBetween:16,slidesPerView:1,autoplay:{delay:2600,disableOnInteraction:false,pauseOnMouseEnter:true},pagination:{el:'.swiper-pagination',clickable:true},breakpoints:{768:{slidesPerView:2},1100:{slidesPerView:3}}})};w.addEventListener('load',()=>{initHeroFrames();initReviewsSlider()})})();
(()=>{const d=document,w=window,header=d.querySelector('.site-header'),nav=d.querySelector('.site-nav');if(!header)return;const mq=w.matchMedia('(max-width: 760px)');let lastY=w.scrollY||0,ticking=false,stopTimer=null;const show=()=>header.classList.remove('header-hidden');const hide=()=>header.classList.add('header-hidden');const onScroll=()=>{if(!mq.matches){show();lastY=w.scrollY||0;return}if(stopTimer)w.clearTimeout(stopTimer);stopTimer=w.setTimeout(show,160);if(ticking)return;ticking=true;w.requestAnimationFrame(()=>{const y=w.scrollY||0,delta=y-lastY;if(Math.abs(delta)<6){ticking=false;return}if(nav&&nav.classList.contains('open')){show();lastY=y;ticking=false;return}if(delta>0&&y>88)hide();else show();lastY=y;ticking=false})};w.addEventListener('scroll',onScroll,{passive:true});w.addEventListener('resize',()=>{if(!mq.matches)show()},{passive:true});w.addEventListener('orientationchange',()=>{if(!mq.matches)show()},{passive:true})})();